<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>T-FORCE SENTINEL CMD</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&display=swap" rel="stylesheet">
    
    <meta name="theme-color" content="#000000"/>

    <!-- SECURITY: CSP -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://unpkg.com https://cdn.tailwindcss.com https://www.gstatic.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src https://fonts.gstatic.com; connect-src 'self' https://generativelanguage.googleapis.com https://en.wikipedia.org https://firestore.googleapis.com https://identitytoolkit.googleapis.com https://securetoken.googleapis.com https://www.googleapis.com; img-src 'self' data: https: blob:;">

    <!-- CRITICAL FIX: Use Legacy React/ReactDOM Dev for Stability -->
    <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

    <style>
        :root { --bg-color: #000000; --card-bg: #111111; --primary-red: #dc2626; --text-color: #ffffff; --text-muted: #9ca3af; --border-color: #333333; --success-color: #22c55e; }
        body { margin: 0; padding: 0; height: 100%; box-sizing: border-box; background-color: var(--bg-color); color: var(--text-color); font-family: 'Rajdhani', sans-serif; display: flex; justify-content: center; }
        #root { width: 100%; max-width: 480px; background-color: #000; min-height: 100vh; position: relative; box-shadow: 0 0 50px rgba(0,0,0,0.5); }
        .hidden { display: none !important; }
        .app-container { display: flex; flex-direction: column; height: 100vh; width: 100%; }
        header { position: sticky; top: 0; background: rgba(0,0,0,0.95); border-bottom: 2px solid var(--primary-red); padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; z-index: 1000; }
        .input-label { color: var(--primary-red); font-weight: bold; font-size: 12px; margin-bottom: 5px; display: block; }
        .input-field { width: 100%; padding: 14px; background: #000; border: 1px solid var(--border-color); color: white; border-radius: 2px; box-sizing: border-box; margin-bottom: 12px; }
        .btn-primary { background: var(--primary-red); color: white; padding: 14px 20px; border: none; border-radius: 2px; cursor: pointer; font-weight: 700; text-transform: uppercase; width: 100%; }
        .btn-secondary { background: var(--card-bg); color: var(--text-muted); border: 1px solid var(--border-color); padding: 14px 20px; border-radius: 2px; cursor: pointer; font-weight: 700; text-transform: uppercase; width: 100%; }
        .nav { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 480px; background: #000; border-top: 2px solid #333; display: flex; justify-content: space-around; padding: 12px 0; z-index: 1000; }
        .nav-item { background: none; border: none; color: var(--text-muted); padding: 5px; cursor: pointer; }
        .nav-item.active { color: var(--primary-red); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        window.onerror = function(message, source, lineno, colno, error) {
            const root = document.getElementById('root');
            root.innerHTML = `<div style="position:fixed; top:0; left:0; width:100%; height:100%; background:black; color:red; padding:20px; font-family:monospace; white-space:pre-wrap;">‚ö†Ô∏è SYSTEM CRASH ‚ö†Ô∏è\n\n${message}\n\nLine: ${lineno}</div>`;
        };
    </script>

    <!-- FIREBASE BRIDGE -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, doc, setDoc, serverTimestamp, getDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBwhzGsK-ah7ObMOgpRDlzGghycLNinm6g",
            authDomain: "tforce-guardian-system.firebaseapp.com",
            projectId: "tforce-guardian-system",
            storageBucket: "tforce-guardian-system.firebasestorage.app",
            messagingSenderId: "194168927826",
            appId: "1:194168927826:web:18073e1a188b8e4408118b"
        };

        try {
            const app = initializeApp(firebaseConfig);
            window.fbAuth = getAuth(app);
            window.fbDb = getFirestore(app);
            window.fbFuncs = { onAuthStateChanged, signInWithEmailAndPassword, signOut, collection, onSnapshot, doc, setDoc, serverTimestamp, getDoc, createUserWithEmailAndPassword };
            window.dispatchEvent(new Event('firebase-ready'));
        } catch (e) {
            console.error("Firebase Init Error:", e);
        }
    </script>

    <!-- APP LOGIC (V7.8) -->
    <script type="text/babel">
        (function() {
            const { useState, useEffect, useRef } = React;

            // --- CORE UTILITIES ---
            const useStickyState = (defaultValue, key) => {
                const [value, setValue] = useState(() => { try { const stickyValue = window.localStorage.getItem(key); return stickyValue !== null ? JSON.parse(stickyValue) : defaultValue; } catch (e) { return defaultValue; } });
                useEffect(() => { window.localStorage.setItem(key, JSON.stringify(value)); }, [key, value]);
                return [value, setValue];
            };
            
            // --- LANGUAGE CORE ---
            const translations = {
                EN: {
                    LOGIN: "LOGIN", AUTHENTICATE: "AUTHENTICATE", SIGN_OUT: "SIGN OUT", ON_DUTY: "ON DUTY", OFF_DUTY: "OFF DUTY", CMD_CENTER: "SENTINEL", INTEL: "INTEL", GEAR: "GEAR", REPORT: "REPORT", RED_TEAM: "RED TEAM", EVAC: "EVAC", CRISIS: "CRISIS", MEDICAL: "MEDICAL", ATTACK: "ATTACK", ARREST: "ARREST",
                    AREA: "OPERATION AREA", SITREP: "SITREP", HEATMAP: "HEATMAP", TARGET: "TARGET VETTING", DEEP_SCAN: "DEEP SCAN", LOG_ENTRY: "LOG ENTRY", COMPILE: "COMPILE SHIFT", MANUAL: "MANUAL", AI_WRITER: "AI WRITER", ROUGH_NOTES: "ROUGH NOTES", COORDS: "COORDINATES", NO_ACTIVE_UNITS: "NO ACTIVE UNITS", TIME: "TIME", LOCATION: "LOCATION", DETAILS: "DETAILS", SAVE: "SAVE", API_KEY: "API KEY", STOP: "STOP", GO_LIVE: "GO LIVE",
                    AI_SUFFIX: " in English", RED_TEAM_PROMPT: "Role: Expert Security Red Team. Target Scenario: [SCENARIO]. Identify 3 critical vulnerabilities and 3 specific tactical countermeasures. Format: Bullet points.", REPORT_PROMPT: "Role: Professional Bodyguard. Task: Convert these rough notes into a formal Security Incident Log / Daily Report. Use military time and professional language. Notes: [NOTES], in English.", SCENARIO: "SCENARIO", ANALYZE: "ANALYZE", SETTINGS: "SETTINGS"
                },
                GR: {
                    LOGIN: "Œ£Œ•ŒùŒîŒïŒ£Œó", AUTHENTICATE: "Œ§ŒëŒ•Œ§ŒüŒ†ŒüŒôŒóŒ£Œó", SIGN_OUT: "ŒëŒ†ŒüŒ£Œ•ŒùŒîŒïŒ£Œó", ON_DUTY: "Œ£Œï Œ•Œ†ŒóŒ°ŒïŒ£ŒôŒë", OFF_DUTY: "ŒïŒöŒ§ŒüŒ£ Œ•Œ†ŒóŒ°ŒïŒ£ŒôŒëŒ£", CMD_CENTER: "SENTINEL", INTEL: "Œ†ŒõŒóŒ°ŒüŒ¶ŒüŒ°ŒôŒïŒ£", GEAR: "ŒïŒûŒüŒ†ŒõŒôŒ£ŒúŒüŒ£", REPORT: "ŒëŒùŒëŒ¶ŒüŒ°Œë", RED_TEAM: "RED TEAM", EVAC: "ŒïŒöŒöŒïŒùŒ©Œ£Œó", CRISIS: "ŒöŒ°ŒôŒ£Œó", MEDICAL: "ŒôŒëŒ§Œ°ŒôŒöŒü", ATTACK: "ŒïŒ†ŒôŒòŒïŒ£Œó", ARREST: "Œ£Œ•ŒõŒõŒóŒ®Œó",
                    AREA: "Œ†ŒïŒ°ŒôŒüŒßŒó", SITREP: "ŒöŒëŒ§ŒëŒ£Œ§ŒëŒ£Œó", HEATMAP: "ŒßŒëŒ°Œ§ŒóŒ£ ŒïŒìŒöŒõŒóŒúŒëŒ§Œ©Œù", TARGET: "ŒïŒõŒïŒìŒßŒüŒ£ Œ£Œ§ŒüŒßŒüŒ•", DEEP_SCAN: "ŒíŒëŒòŒôŒë Œ£ŒëŒ°Œ©Œ£Œó", LOG_ENTRY: "ŒïŒôŒ£ŒüŒîŒüŒ£ ŒëŒ°ŒßŒïŒôŒüŒ•", COMPILE: "Œ£Œ•ŒùŒ§ŒëŒûŒó ŒíŒëŒ°ŒîŒôŒëŒ£", MANUAL: "ŒßŒïŒôŒ°ŒüŒöŒôŒùŒóŒ§Œü", AI_WRITER: "AI Œ£Œ•ŒùŒ§ŒëŒöŒ§ŒóŒ£", ROUGH_NOTES: "Œ†Œ°ŒüŒßŒïŒôŒ°ŒïŒ£ Œ£ŒóŒúŒïŒôŒ©Œ£ŒïŒôŒ£", COORDS: "Œ£Œ•ŒùŒ§ŒïŒ§ŒëŒìŒúŒïŒùŒïŒ£", NO_ACTIVE_UNITS: "ŒîŒïŒù ŒíŒ°ŒïŒòŒóŒöŒëŒù ŒïŒùŒïŒ°ŒìŒïŒ£ ŒúŒüŒùŒëŒîŒïŒ£", TIME: "Œ©Œ°Œë", LOCATION: "Œ§ŒüŒ†ŒüŒòŒïŒ£ŒôŒë", DETAILS: "ŒõŒïŒ†Œ§ŒüŒúŒïŒ°ŒïŒôŒïŒ£", SAVE: "ŒëŒ†ŒüŒòŒóŒöŒïŒ•Œ£Œó", API_KEY: "ŒöŒõŒïŒôŒîŒô API", STOP: "Œ†ŒëŒ•Œ£Œó", GO_LIVE: "ŒïŒùŒëŒ°ŒûŒó", SCENARIO: "Œ£ŒïŒùŒëŒ°ŒôŒü", ANALYZE: "ŒëŒùŒëŒõŒ•Œ£Œó", SETTINGS: "Œ°Œ•ŒòŒúŒôŒ£ŒïŒôŒ£"
                }
            };
            const getT = (lang, key) => translations[lang][key] || translations['EN'][key] || key;

            // --- HEADER & NAVIGATION ---
            const Header = ({ setView, view, lang, setLang }) => (
                <header>
                    <div style={{position: 'absolute', top: '20px', left: '20px', display:'flex', gap:'5px'}}>
                        <button onClick={() => setLang('EN')} style={{background:'none', border:'none', cursor:'pointer', opacity: lang === 'EN' ? 1 : 0.5}}>üá¨üáß</button>
                        <button onClick={() => setLang('GR')} style={{background:'none', border:'none', cursor:'pointer', opacity: lang === 'GR' ? 1 : 0.5}}>üá¨üá∑</button>
                    </div>
                    <h1><span style={{color: '#dc2626'}}>T-FORCE</span> <span style={{color:'white'}}>{getT(lang, 'CMD_CENTER')}</span></h1>
                    
                    <nav>
                        <button className={`btn-secondary nav-btn ${view==='dashboard'?'active':''}`} onClick={()=>setView('dashboard')}>{getT(lang, 'CMD_CENTER')}</button>
                        <button className={`btn-secondary nav-btn ${view==='intel'?'active':''}`} onClick={()=>setView('intel')}>{getT(lang, 'INTEL')}</button>
                        <button className={`btn-secondary nav-btn ${view==='report'?'active':''}`} onClick={()=>setView('report')}>{getT(lang, 'REPORT')}</button>
                        <button className={`btn-secondary nav-btn ${view==='redteam'?'active':''}`} onClick={()=>setView('redteam')}>{getT(lang, 'RED_TEAM')}</button>
                    </nav>
                    
                    <button className="sign-out-btn" onClick={() => window.fbFuncs.signOut(window.fbAuth)}>{getT(lang, 'SIGN_OUT')}</button>
                </header>
            );

            // --- LOGIN COMPONENT ---
            const Login = ({ setLang }) => {
                const [email, setEmail] = useState("");
                const [pass, setPass] = useState("");
                const [localLang, setLocalLang] = useState('EN'); 

                const handleLogin = (e) => {
                    e.preventDefault();
                    window.fbFuncs.signInWithEmailAndPassword(window.fbAuth, email, pass).catch(err => alert(err.message));
                };

                return (
                    <div className="login-container">
                        <div className="login-box">
                            <div style={{position: 'absolute', top: '10px', right: '10px', display:'flex', gap:'5px'}}>
                                 <button onClick={() => { setLocalLang('EN'); setLang('EN'); }} style={{background:'none', border:'none', cursor:'pointer', opacity: localLang === 'EN' ? 1 : 0.5}}>üá¨üáß</button>
                                 <button onClick={() => { setLocalLang('GR'); setLang('GR'); }} style={{background:'none', border:'none', cursor:'pointer', opacity: localLang === 'GR' ? 1 : 0.5}}>üá¨üá∑</button>
                            </div>
                            <h2>{getT(localLang, 'LOGIN')}</h2>
                            <form onSubmit={handleLogin}>
                                <input className="input-field" type="email" placeholder="Email" value={email} onChange={e=>setEmail(e.target.value)} required />
                                <input className="input-field" type="password" placeholder="Password" value={pass} onChange={e=>setPass(e.target.value)} required />
                                <button type="submit" className="btn-primary">{getT(localLang, 'AUTHENTICATE')}</button>
                            </form>
                        </div>
                    </div>
                );
            };

            // --- DASHBOARD ---
            const Dashboard = ({ setView, user, lang }) => {
                const [broadcasting, setBroadcasting] = useState(false);
                const toggleBroadcast = () => setBroadcasting(!broadcasting);
                
                return (
                    <div style={{padding:'16px'}}>
                        <div style={{backgroundColor:'#111', padding:'16px', borderLeft:'6px solid #dc2626', display:'flex', justifyContent:'space-between', alignItems:'center'}}>
                            <div><h2 style={{margin:0, fontSize:'24px'}}>{user.email.split('@')[0].toUpperCase()}</h2><small style={{color: broadcasting ? '#22c55e' : '#666', fontWeight:'bold'}}>{broadcasting ? `‚óè ${getT(lang, 'BROADCASTING')}` : `‚óã ${getT(lang, 'OFF_DUTY')}`}</small></div>
                            <button onClick={toggleBroadcast} className="btn-secondary" style={{padding:'8px', backgroundColor: broadcasting ? '#22c55e' : '#333', border:'none'}}>{broadcasting ? getT(lang, 'STOP') : getT(lang, 'GO_LIVE')}</button>
                        </div>
                        <div style={{display:'grid', gridTemplateColumns:'1fr 1fr', gap:'10px', marginTop:'16px'}}>
                            <button className="btn-secondary" onClick={() => setView('intel')}>üîé {getT(lang, 'INTEL')}</button>
                            <button className="btn-secondary" onClick={() => setView('scanner')}>üì∑ {getT(lang, 'SCAN_LOGS')}</button>
                            <button className="btn-secondary" onClick={() => setView('gear')}>üéí {getT(lang, 'GEAR')}</button>
                            <button className="btn-secondary" onClick={() => setView('report')}>üìù {getT(lang, 'REPORT')}</button>
                            <button className="btn-secondary" onClick={() => setView('redteam')}>‚öîÔ∏è {getT(lang, 'RED_TEAM')}</button>
                            <button className="btn-primary" onClick={() => setView('evac')}>üß≠ {getT(lang, 'EVAC')}</button>
                        </div>
                    </div>
                );
            };

            // --- MODULES (Placeholder Logic) ---
            const IntelHub = ({ lang }) => { return (<div style={{padding:'16px'}}><h2 style={{color:'white', borderLeft:'4px solid #dc2626', paddingLeft:'10px'}}>{getT(lang, 'INTEL')} HUB</h2></div>); };
            const QRScanner = ({ lang }) => { return (<div style={{padding:'16px'}}><h2 style={{color:'white', borderLeft:'4px solid #dc2626', paddingLeft:'10px'}}>üì∑ {getT(lang, 'SCAN_LOGS')}</h2></div>); };
            const GearChecklist = ({ lang }) => { return (<div style={{padding:'16px'}}><h2 style={{color:'white', borderLeft:'4px solid #dc2626', paddingLeft:'10px'}}>üéí {getT(lang, 'GEAR')}</h2></div>); };
            const ReportGen = ({ lang }) => { return (<div style={{padding:'16px'}}><h2 style={{color:'white', borderLeft:'4px solid #dc2626', paddingLeft:'10px'}}>üìù {getT(lang, 'REPORT')}</h2></div>); };
            const RedTeam = ({ lang }) => { return (<div style={{padding:'16px'}}><h2 style={{color:'white', borderLeft:'4px solid #dc2626', paddingLeft:'10px'}}>‚öîÔ∏è {getT(lang, 'RED_TEAM')}</h2></div>); };
            const EvacMap = ({ lang }) => { return (<div style={{padding:'16px'}}><h2 style={{color:'white', borderLeft:'4px solid #dc2626', paddingLeft:'10px'}}>üß≠ {getT(lang, 'EVAC')}</h2></div>); };
            const CrisisMode = ({ lang }) => { return (<div style={{padding:'16px'}}><h2 style={{color:'#dc2626'}}>üö® {getT(lang, 'CRISIS')}</h2></div>); };
            const Settings = ({ lang, close }) => { return (<div style={{padding:'16px'}}><h3>‚öôÔ∏è {getT(lang, 'SETTINGS')}</h3><button className="btn-primary" onClick={close}>{getT(lang, 'SAVE')}</button></div>); };

            // --- ROOT COMPONENT ---
            function SentinelApp() {
                const [user, setUser] = useState(null);
                const [fbReady, setFbReady] = useState(false);
                const [view, setView] = useState('dashboard');
                const [lang, setLang] = useStickyState('EN', 'sentinel_lang');

                useEffect(() => {
                    const init = () => {
                        if(window.fbFuncs && window.fbAuth) {
                            window.fbFuncs.onAuthStateChanged(window.fbAuth, (u) => { 
                                setUser(u); 
                                setFbReady(true); 
                            });
                        }
                    };
                    
                    if(window.fbAuth) init();
                    window.addEventListener('firebase-ready', init);
                }, []);

                if(!fbReady) return <div style={{color:'#dc2626', display:'flex', justifyContent:'center', alignItems:'center', height:'100vh', fontSize:'24px', letterSpacing:'2px'}}>INITIALIZING SYSTEM...</div>;
                
                if (!user) return <Login setLang={setLang} />;

                return (
                    <div className="app-container">
                        <Header setView={setView} view={view} lang={lang} setLang={setLang} />

                        <main>
                            {view === 'dashboard' && <Dashboard setView={setView} user={user} lang={lang} />}
                            {view === 'intel' && <IntelHub lang={lang} />}
                            {view === 'scanner' && <QRScanner lang={lang} />}
                            {view === 'gear' && <GearChecklist lang={lang} />}
                            {view === 'report' && <ReportGen lang={lang} />}
                            {view === 'redteam' && <RedTeam lang={lang} />}
                            {view === 'evac' && <EvacMap lang={lang} />}
                            {view === 'crisis' && <CrisisMode lang={lang} />}
                            {view === 'settings' && <Settings lang={lang} close={() => setView('dashboard')} />}
                        </main>

                        <div className="nav">
                            <button className={`nav-item ${view==='scanner'?'active':''}`} onClick={()=>setView('scanner')}><span style={{fontSize:'24px'}}>üì∑</span></button>
                            <button className={`nav-item ${view==='gear'?'active':''}`} onClick={()=>setView('gear')}><span style={{fontSize:'24px'}}>üéí</span></button>
                            <div style={{position:'relative', top:'-5px'}}><button onClick={() => setView('crisis')} className="nav-item" style={{width:'64px', height:'64px', borderRadius:'50%', border:'4px solid #000', backgroundColor:'#dc2626', color:'white', fontSize:'28px', display:'flex', alignItems:'center', justifyContent:'center', boxShadow:'0 0 15px rgba(220, 38, 38, 0.4)'}}>üö®</button></div>
                            <button className={`nav-item ${view==='evac'?'active':''}`} onClick={()=>setView('evac')}><span style={{fontSize:'24px'}}>üß≠</span></button>
                            <button className={`nav-item ${view==='settings'?'active':''}`} onClick={() => setView('settings')}><span style={{fontSize:'24px'}}>‚öôÔ∏è</span></button>
                        </div>
                    </div>
                );
            }

            // --- FINAL RENDER CALL (Legacy Method) ---
            ReactDOM.render(<SentinelApp />, document.getElementById('root'));
        })();
    </script>
</body>
</html>

